<html>
<center>
<img src='data_reduction_gui_logo.bmp'>
</center>
<br>
Once the DataReduction tool selected, you have to click one more time the IDL Virtual machine flash 
window. From there, you have to select your instrument, 
<b><a href='data_reduction.html#REF_L'>REF_L</a></b> or 
<b><a href='data_reduction.html#REF_M'>REF_M</a></b>.<br>
<br><center><img src='data_reduction_portal.png'></img></center>
<br>
<br>
<hr size=4 width=50%>
<center><h2>TABLE OF CONTENTS</h2></center>
<ul>
<li><a href="#link1"><h3>Liquids Reflectometer</h3></a></li>
  <ul>
  <li><a href="#link2">Input</a></li>
    <ul>
    <li><a href="#link3">File</a></li>
      <ul>
      <li><a href="#link5">Working path</a></li>
      <li><a href="#link6">Color Tool</a></li>
      <li><a href="#link7">Exit</a></li>
      </ul>
    <li><a href="#link8">Mode</a></li>
      <ul>
      <li><a href="#link9">Selection</a></li>
      <li><a href="#link10">Infos</a></li>
      </ul>
    <li><a href="#link10_a">sns_idl_tools</a></li>
    </ul>
  <li><a href="#link10_b">Run number</a></li>
  <li><a href="#link10_c">Mode</a></li>
  <li><a href="#link10_d">Save session</a></li>
  <li><a href="#link11">Display</a></li>
  <li><a href="#link12">Data reduction</a></li>
    <ul>
    <li><a href="#link13">Data reduction</a></li>
      <ul>
      <li><a href="#link14">Pid files</a></li>
      <li><a href="#link15">Normalization</a></li>
      <li><a href="#link16">Norm. bkg.</a></li>
      <li><a href="#link17">bgk.</a></li>
      <li><a href="#link18">ADD NeXus AND RUN or RUN SEQUENTIALLY</a></li>
      <li><a href="#link19">List of intermediate plots</a></li>
      <li><a href="#link20">Information window</a></li>
      <li><a href="#link21">Date reduction result</a></li>
      </ul>
    <li><a href="#link22">Selection tools</a></li>
    <li><a href="#link23">Extra plots</a></li>
    <li><a href="#link24">Log book</a></li>
    </ul>
  </ul>
<li><a href="#link25"><h3>Magnetism Reflectometer</h3></a></li>
  <ul>
  <li><a href="#link30_a">Menu</a></li>
    <ul>
    <li><a href="#link30">File</a></li>
      <ul>
	<li><a href="#link50">Working path...</a></li>
	<li><a href="#link51">Color tool...</a></li>
	<li><a href="#link52">Exit</a></li>
      </ul>
    <li><a href="#link31">sns_idl_tools</a></li>
    </ul>
  <li><a href="#link32">Run number</a></li>
  <li><a href="#link33">Main display</a></li>
  <li><a href="#link34">Distance box</a></li>
  <li><a href="#link70">Tabs</a></li>
    <ul>
    <li><a href="#link35">Data Reduction tab</a></li>
      <ul>
      <li><a href="#link60">Wavelength box</a></li>
      <li><a href="#link61">Detector angle</a></li>
      <li><a href="#link62">Background switch</a></li>
      <li><a href="#link63">Signal-Pid file</a></li>
      <li><a href="#link64">Background-Pid file</a></li>
      <li><a href="#link65">Normalization switch</a></li>
      <li><a href="#link66">Run # box</a></li>
      <li><a href="#link67">Normalization background</a></li>
      <li><a href="#link68">Intermediate plots</a></li>
      </ul>
    <li><a href="#link36">Selection infos tab</a></li>
    <li><a href="#link37">Extra plots tab</a></li>
    <li><a href="#link38">Log book tab</a></li>
    </ul>
  <li><a href="#link39">Selection box</a></li>
  <li><a href="#link40">Selection to keep</a></li>  
  <li><a href="#link41">Selection mode</a></li>
  </ul>
</ul>


















</ul>

<br><hr size=4 width=50%><br>

<h1><u><a id="link1"><a name='REF_L'>Liquids Reflectometer</a></a></u></h1>

Click the area in the picture to get more information.<br><br>


<center><img src='REF_L_images/REF_L_blank.png' usemap="#REF_L_gui"></img></center><br>

<br><br>
<map id="REF_L_gui" name="REF_L_gui">
<area shape="rect" coords="0,16,27,33" alt="menu_button" href="#link3">
<area shape="rect" coords="28,16,51,33" alt="Mode" href="#link8">
<area shape="rect" coords="52,16,114,33" alt="sns_idl_tools" href="#link10_a">
<area shape="rect" coords="3,39,116,65" alt="Run number" href="#link10_b">
<area shape="rect" coords="119,40,162,65" alt="Mode selection" href="#link10_c">
<area shape="rect" coords="165,39,321,66" alt="Save session" href="#link10_d">
<area shape="rect" coords="0,66,321,443" alt="Main display" href="#link11">
<area shape="rect" coords="332,39,388,52" alt="Tabs" href="#link12">
<area shape="rect" coords="332,52,785,305" alt="Data Reduction tab" href="#link13">
<area shape="rect" coords="389,39,450,52" alt="Selection Infos" href="#link22">
<area shape="rect" coords="451,39,498,51" alt="Extra Plots" href="#link23">
<area shape="rect" coords="499,39,535,51" alt="Log Book" href="#link24">
<area shape="rect" coords="331,314,491,358" alt="Selection" href="#link11_a">
</area>

<p>Let's start by having a quick overview of the GUI.<br><br>

The GUI can be divided in 3 regions, <i>input</i>, <i>display</i> and <i>data reduction</i> 
regions.<br>

 <ul>
 <li><h3><b><a id="link2">INPUT</a></b></h3></li>
   <center><img src='REF_L_images/input.png'></img></center>
   <br>The <font color=red><a id="link3">MENU</a></font> button gives access to the following options:
   <br><br>
   <ul>
   <li> <font color=blue><b><a id="link5">Working Path...</a></b></font>: to change the working
        directory. Where all the output files produced by the data reduction will be created.</li>
   <li> <font color=blue><b><a id="link6"Color Tool...</a></b></font>: to change the color of 
        the main display.</li>
   <li> <font color=blue><b><a id="link7">Exit</a></b></font>: to exit the program. This allows the
        program to remove the temporary files used to plot the data. This is why Exit must be
        choosen to exit the program.</li>
   </ul>

<br><center>
<img src='REF_L_images/menu.png'></img></center><br><br>

The <font color=red><a id="link8">Mode</a></font> button gives access to the selection mode that
 can be changed from <i>selection</i> to <i>infos</i>.

<br><center><img src='REF_L_images/selection_menu.png'></img></center><br><br>

 <ul>
 <li> <font color=blue><b><a id="link9">selection</a></b></font>: default mode that allows to
      select regions for signal, background_1 and background_2.<br></li>

      <center><img src='REF_L_images/selection_mode.png'></img></center><br>
 <li> <font color=blue><b><a id="link10">infos</a></b></font>: allows the user to get information
      about the pixel selected.<br></li>

 <center><img src='REF_L_images/infos_mode.png'></img></center>
 </ul>

<br>The <font color=red><a id="link10_a">sns_idl_tools</a></font> this button start another session of sns_idl_tools.
<br><br>

<a id="link10_b"><li><b>Run number</b></li></a>
   <center><img src='REF_L_images/run_number_box.png'></center>
   You can either ask for an <b>archived NeXus</b> file or a <b>local NeXus</b> file.
   <ul>
   <li>archived NeXus: ex: <font color=red>1234</font><br>
       The program will run the command <i>findnexus -iREF_L 1234</i></li>
   <li>local NeXus:  ex: <font color=red>1234*</font> or <font color=red>*1234</font>
       The program will run the command <i>findnexus -iREF_L 1234 --prefix=~/local/</i></li>
   </ul>
   <br>

<li><a id="link10_c"><b>Mode</b></a>:</li> gives the current mode selected (<b>selection</b> or 
<b>infos</b>).<br>
<center><img src='REF_L_images/selection.png'></center><br>

<li><a id="link10_d"><b>Save session</b></a>:</li>
<center><img src='REF_L_images/save_session.png'></center>
Save session when reloading a new run number. When <i>ON</i>, following item are kept:
  <ul>
  <li> signal and background selection, if present.</li>
  <li> Runs # text box of <b>ADD NeXus AND RUN</b> and <b>RUN SEQUENTIALLY</b>. The new run number
  loaded is added to the list if not already part of the list.</li>
  <li> Normalization runs number.</li>
  <li> all status of switches (Norm. bgk., Bkg., Norm. Intermediate files output).</li>
  </ul>
  
<li><h3><b><a id="link11">Display</a></b></h3></li>

The large display on the left is where the NeXus run will be displayed. 

<li> <h3><b><a id="link11_a">The selection interactive</a></b></h3></li>
 tool box placed below the data_reduction window is also part of the display region. This is
 where the user will save the region selected. Doing so will create two txt files that will be
 used by the data reduction tool.

<br><center><img src='REF_L_images/selection_part.png'></img></center>

<li><h3><b><a id="link12">Tabs</a></b></h3></li>
    This window comport 4 tabs: <i><font color=green>Data Reduction</font></i>, 
    <i><font color=green>Selection tools</font></i>,
    <i><font color=green>Extra plots</font></i> and 
    <i><font color=green>Log Book</font></i>.<br>

  <ul>
  <li><font color=green><a id="link13">Data Reduction</a></font></li><br>
      <center><img src='REF_L_images/data_reducton_tab_1.png'></img></center><br>
      <ul>
      <li> <u><a id="link14">Pid files<a>:</u> To be able to activate the <b>START DATA REDUCTION</b>
           button, a signal Pid (Pixel ID) and a Background Pid files must be loaded. To do so, 
           either select the region(s) of interest by using the selection mode in the main display 
	   window or load a Pid file by using the <b>Signal Pid file</b> and/or </b>Back. Pid file</b> 
           buttons. Both a signal and backgound Pid files must be selected to be able to run the
	   data reduction.<br></li><br>        
      <li><u><a id="link15">Normalization</a></u>: if the check box corresponding to the 
      normalization file is on <b>Yes</b>, a run number is required in the text box on the right.</li><br>
      <li><u><a id="link16">Norm. bkg.</a>:</u> normalization background.</li><br>
      <li><u><a id="link17">bkg.</a>:</u> background. Must be checked out if there is no Background
       Pid file.</li><br>
       <li><a id="link18"><u>ADD NeXus AND RUN</u> or <u>RUN SEQUENTIALLY</a></u>:<br><br>
          <ul>
	  <li>ADD NeXus AND RUN: the data reduction program will add all the NeXus files given in
	   the command line.</li>
	  <li>RUN SEQUENTIALLY: the data reduction will work on the first valid NeXus run number
	   found in the command line, will display the resulting plot(s) and then will move to the
	   next run number. </li>
	  </ul>

<br><u>Input accepted:</u><font color=red><i>1210,1212,1230-1235,1238</i></font><br>
will run the data reduction using run 1210,1212,1230,1231,1232....1235 and 1238. In case one of the run
 number does not have a NeXus file archived, this run number will not be part of the data reduction. To
 get more information about the run number rejected, check the log_book (last tab).<br>
<br><li><u><a id="link19">List of intermediate plots</a>:</u> give access to a window that let the user
 select which, if any, plots he wants to display.<br>
<center><img src='REF_L_images/intermediate_plots.png'></img></center></br>
<br>If at least 1 plot has been selected, the plot(s) is visible, once the full data reduction process 
done, in the third tab as shown here.<br><br>
<center><img src='REF_L_images/extra_plots.png'></img></center>
<br>
<br><li><u><a id="link20">information window: gives some brief information:</a></u><br>
  <ul>
  <li> Open and plot NeXus file</li>
  <li> Selection saved</li>
  <li> x, y and number of counts of pixel selected in infos mode</li>
  <li> data reduction process, start and end</li>
  <li> ...</li>
  </ul>
<br>
<li><u><a id="link21">Data reduction result</a>:</u><br> The window on the right will plot the result of
 the data reduction.<br>
<center><img src='REF_L_images/data_reduction_plot.png'></img></center>
</ul>
<li><font color=green><a id="link22">Selection infos</a><br></font>
<br> This text box gives information about the region selected. There is one tab for each of the region
 selected, signal, background region 1 (background_1) and background region 2 (background_2). The infos 
given are:
<ul><li>x, y, intensity and pixelID of the two corners of the box</li>
<li>Number of pixels inside the selection box</li>
<li>Selection width (in pixels)</li>
<li>Selection height (in pixels)</li>
<li>Total number of counts inside selection</li>
<li>Total number of counts outside selection</li>
<li>Average number of counts inside selection</li>
<li>Average number of counts outside selection</li>
</ul></li>
<br><center><img src='REF_L_images/data_reduction_tab-2.png'></center>
<br>

<li><font color=green><a id="link23">Extra plots</a></font><br>
 <br>Where the intermediate or extra plots are displayed if at least one has been selected 
 before running the data reduction.
</li>

<li><font color=green><a id="link24">Log Book</a></font><br>
 <br>
<br><center><img src='REF_L_images/data_reduction_tab_4.png'></center>
<br>
</li>
</ul>
</ul>


<hr size=4 width=50%>

<h1><u><a name='REF_M'><a id="link25">Magnetism Reflectometer</a></a></u></h1>
<br>

<center><h3><font color=blue><b>Move the mouse over the picture and click to get information about a
 particular feature.</b></font></h3></center><center><img src='REF_M_images/Data_reduction_REF_M_blank.png'
 usemap="#REF_M_gui"></center>

<br><br>
<map id="REF_M_gui" name="REF_M_gui">
<area shape="rect" coords="0,0,25,29" alt="menu_button" href="#link30">
<area shape="rect" coords="25,0,82,29" alt="sns_idl_tools_button" href="#link31">
<area shape="rect" coords="0,37,182,60" alt="run_number_box" href="#link32">
<area shape="rect" coords="3,64,362,364" alt="display" href="#link33">
<area shape="rect" coords="0,370,477,404" alt="distance_labels" href="#link34">
<area shape="rect" coords="365,64,418,75" alt="data_reduction_tab" href="#link35">
<area shape="rect" coords="365,75,551,314" alt="data_reduction_tab" href="#link35">
<area shape="rect" coords="418,64,478,75" alt="selection_infos_tab" href="#link36">
<area shape="rect" coords="478,64,523,75" alt="extra_plots_tab" href="#link37">
<area shape="rect" coords="523,64,556,75" alt="log_book_tab" href="#link38">
<area shape="rect" coords="337,330,558,365" alt="signal_back_1_back_2" href="#link39">
<area shape="rect" coords="574,330,706,363" alt="selection_to_keep" href="#link40">
<area shape="rect" coords="723,331,769,364" alt="select_info" href="#link41">
</map>

<ul>
<li><a id="link30_a">Menu</a></li>
   <ul>
   <li><a id="link30">File</a></li>
   <center><img src='REF_M_images/file_menu.png'></center><br>
   Use this menu to <b>open a nexus file</b>, change the <b>working path</b>, change the 
   <b>color tool</b> and <b>exit</b> the program.<br>
     <ul>
     <li><b><a id="link50">Working Path...</a></b> 
        allows the user to change the output folder. The default output folder is 
        defined as being <font color=red>~/local/REF_M/</font>. If the new folder defined does not exist
        yet, the program will creat this one for you.</li>
     <li><b><a id="link51">Color Tool...</a></b> 
        allows to change the contrast and color of the main display window. Can be
        used when for example the contrast between the signal and the background is too low.</li>
     <li><b>< id="link52">Exit</a></b> 
        exits the program. This should be the prefer way of exiting the program due to 
        the fact that, using this <i>exit</i> way, the program will clean up the temporary files it 
        created before closing itself.</i>
     </ul><br>

     <a id="link31">
     <li>sns_idl_tools</li></a>
     <center><img src='REF_M_images/sns_idl_tools_box.png'></center><br>
     Click this button to start another session of sns_idl_tools.<br>
     </ul>


<a id="link32"><li>Run number</li></a>
   <center><img src='REF_M_images/run_number_box.png'></center>
   You can either ask for an <b>archived NeXus</b> file or a <b>local NeXus</b> file.
   <ul>
   <li>archived NeXus: ex: <font color=red>1234</font><br>
       The program will run the command <i>findnexus -iREF_M 1234</i></li>
   <li>local NeXus:  ex: <font color=red>1234*</font> or <font color=red>*1234</font>
       The program will run the command <i>findnexus -iREF_M 1234 --prefix=~/local/</i></li>
   </ul><br>
   
<a id="link33"><li>Main display</li></a>
   <center><img src='REF_M_images/display.png'></center>
   Display the 304 wide by 256 height histogram data integrated over all time bins. According to the
   active mode (selection or infos), clicking will either define the first corner of the selection
   box or the x, y and number of counts of the pixel selected (see the <a href='#link39'>selection 
   box</a> for more information).<br><br>

<a id="link34"><li>Distance box</li></a>
   <center><img src='REF_M_images/distance_box.png'></center>
   This box allows the user to compare the various distances given by the DAS and used by the NeXus file.
   This box gives 4 different distances:
   <ul>
   <li>distance sample-detector (in mm) given by the DAS, or in other terms, value found in the
    cvinfo.xml file</li>
   <li>distance sample-detector (in m) given by the NeXus file</li>
   <li>distance moderator-sample (in mm) given by the DAS and found in the cvinfo.xml file</li>
   <li>distance moderator-sample (in m) given by the NeXus file</li>
   </ul><br>

   <ul>
   <li><a id="link70">Tabs</a></li>

   <a id="link35"><li>data reduction tab</li></a>
   <center><img src='REF_M_images/data_reduction_tab.png'></center><br>
   This is where the data reduction stage will take place. See the tutorial part for more information
   about the way to run it. The various field are:
   <ul>
   <li><a id="link60">Wavelenght box</a>: 
       min, max and width in Angstroms</li>
   <li><a id="link61">Detector angle</a>: 
       value and incertity in radians or degres.</li>
   <li><a id="link62">Background switch</a>: 
       if no background pid file has been saved or selected, this switch will turn
       off automatically. If the switch is turned on and no background pid file has been selected, the <b>
       start data reduction</b> switch will stay unable.</li>
   <li><a id="link63">Signal - Pid file</a>: 
      an old pid file can be loaded here, or if a signal selection has been made and 
      save, the pid file will be automatically created and its name will populate the text box on the right
      of the <b>Signal-Pid file</b> button.</li>
   <li><a id="link64">Background - Pid file</a>: 
      works the same as <b>Signal - Pid file button</b></li>
   <li><a id="link65">Normalization switch</a>. 
      If switch is on, a NeXus run number is required.</li>
   <li><a id="link66">Run # box</a>. 
     If the same pid files can be applied on several run number, it is possible to run 
     several data reduction one after the other. To do so, you can either enter the run number one after
     the other, or use a range of runs as illustrated on the following picture.<br>
     <center><img src='REF_M_images/run_input_1.png'></center><br>
     Doing so will run the data reduction on runs 1,2,3,....10. To remove a run undesired from the list,
     just click on the run inside the list, the run will be automatically removed from the list.<br>
     <center><img src='REF_M_images/run_input_2.png'></center><br></li>
     the <b>?</b> button is a reminder of the way you can enter the data.
   <li>Normalization background (Norm. bkg.) can be turned on or off.</li>
   <li>Intermediate plots. Gives a list of intermediate plots that can be generated during the data 
     reduction. Here is the list of such plots available for the Magnetism Reflectometer.<br>
   <center><img src='REF_M_images/intermediate_plots_tab.png'></center><br><br></ul>

<a id="link36"><li>Selection infos tab</li></a>
   <center><img src='REF_M_images/selection_infos_tab.png'></center>
   <br> This text box gives information about the region selected. There is one tab for each of 
   the region selected, signal, background region 1 (background_1) and background region 2 
   (background_2). The infos given are:
   <ul>
   <li>x, y, intensity and pixelID of the two corners of the box</li>
   <li>Number of pixels inside the selection box</li>
   <li>Selection width (in pixels)</li>
   <li>Selection height (in pixels)</li>
   <li>Total number of counts inside selection</li>
   <li>Total number of counts outside selection</li>
   <li>Average number of counts inside selection</li>
   <li>Average number of counts outside selection</li>
   </ul>
   <br>
   
<a id="link37"><li>Extra plots</li></a>
   <center><img src='REF_M_images/extra_plots_tab.png'></center>
   This is where the plots selected are displayed.<br>

<a id="link38"><li>Log Book</li></a>
   <center><img src='REF_M_images/log_book_tab.png'></center>
   Gives a detail of most of the function used by the program. The data reduction command line for example
   is displayed. This log book is mainly used when something is wrong or strange in the result.<br><br>
   
   </ul>

<a id="link39"><li>Selection box</li></a>
   <center><img src='REF_M_images/selection_box_left.png'></center>
   The default mode is <b>selection</b> and the default selection is <b>signal</b>. To select the
 background region #1, check the <font color=red>Back_1</font> switch and select the region on the
 main display. A second background region can be selected by checking <font color=red>Back_2</font>. 
To clear a selection, check first the selection you want to remove <font color=red>signal</font>, 
<font color=red>Back_1</font> or 
   <font color=red>Back_2</font> and press <b>CLEAR SELECTION</b>.<br><br>

<a id="link40"><li>Selection to keep</li></a>
   <center><img src='REF_M_images/selection_box_center.png'></center>
   One of the great feature of this program is to be able to keep a selection and apply this selection on 
   another NeXus file. To do so, select a region of interest (signal and/or background) and press the
   selection you want to keep (signal and/or background). Open another NeXus file and the previous saved
   selection will be displayed on the new plot.<br><br>
   The following case show how the three region are redisplayed on the new run number. It is not necessary
   to save the selection and create the Pid files. <br>
   <center><img src='REF_M_images/before_saving.png'><img src='REF_M_images/after_saving.png'>
   </center><br><br>

<a id="link41"><li>Selection mode</li></a>
   <center><img src='REF_M_images/selection_box_right.png'></center>
   To work in <b>selection mode</b> check the Select switch, and to work in <b>info mode</b>, check the
   Info switch. The <b>info mode</b> gives the x, y and number of counts of the pixel selected in the
   main display.
</center>

</html>






