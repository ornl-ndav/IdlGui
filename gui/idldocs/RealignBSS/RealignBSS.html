<html>
<body>
<center>
<h1>RealignBSS</h1>
This tool is used by the Backscattering instrument to realign the pixels and create 
a local NeXus file of the realign data.<br><br>
</center>
</body>

<center><hr size=4 width=50%></center>

<center><h2>TABLE OF CONTENTS</h2></center>
<ul>
<li><h3><font color=red><a href="#link0">Description of GUI</a></font></h3></li>
 <ul>
 <li><b>Top Menu</b></li>
  <ul>
  <li><a href="#link1">File</a></li>
  <li><a href="#link2">RealignGUI</a></li>
  <li><a href="#link3">sns_idl_tools</a></li>
  </ul>
 <li><a href="#link4"><b>Main displays</b></a></li>
  <ul>
  <li><a href="#link5">Tube per tube plot</a></li>
  <li><a href="#link6">Tube per tube for each Nt</a></li>
  <li><a href="#link7">Counts vs TOF</a></li>
  </ul>
 <li><a href="#link8"><b>Edges interactive window</b></a></li>
 <li><a href="#link9"><b>DAS's plot</b></a></li>
 <li><a href="#link10"><b>Main interactive tab</b></a></li>
 <li><a href="#link11"><b>Log book tab</b></a></li>
 <li><a href="#link13"><b>Mapped plot</b></a></li>
 </ul>
<li><h3><font color=red><a href="#link20">Tutorial</a></font></h3></li>
  <ul>
  <li><a href="#link21">Open NeXus</a></li>
  <li><a href="#link22">Realign data</a></li>
    <ul>
    <li><a href="#link23">Check data</a></li>
      <ul>
      <li><a href="#link24">Check counts of a tube</a></li>
      <li><a href="#link25">Check counts of a pixelID</a></li>
      </ul>
    <li><a href="#link26">Interact with data</a></li>
      <ul>
      <li><a href="#link27">Moved precalculated tube edges</a></li>
      <li><a href="#link28">Removed/add pixel</a></li>
      <li><a href="#link29">Removed/add tube</a></li>
      <li><a href="#link30">Reinitialize all variables</a></li>
      </ul>
    <li><a href="#link31">Check tube per tube data for a given time bin</a></li>
    <li><a href="#link32">check counts versus time of flight</a></li>
    </ul>
  <li><a href="#link33">Create realigned data file</a></li>
  <li><a href="#link34">Create local NeXus file</a></li>
  <li><a href="#link35">Check result using Counts vs TOF</a></li>
  </ul>
</ul>

<center><hr size=4 width=50%></center><br>

<br><h3>Click on picture to get more information about a particular element</h3>
<center><img src='images/RealignGUI_blank.png' usemap="RealignGUI"></center>

<br>
<map id="RealignGUI" name="RealignGUI">
<area shape="rect" coords="0,18,34,38" alt="file menu" href="#link1">
<area shape="rect" coords="31,18,85,38" alt="RealignGUI menu" href="#link2">
<area shape="rect" coords="85,18,153,38" alt="sns_idl_tools menu" href="#link3">
<area shape="rect" coords="5,65,396,311" alt="Main display region" href="#link4">
<area shape="rect" coords="6,49,85,63" alt="tube per tube plot" href="#link5">
<area shape="rect" coords="87,49,201,63" alt="tube per tube for each Nt" href="#link6">
<area shape="rect" coords="203,49,264,63" alt="counts vs tof" href="#link7">
<area shape="rect" coords="2,311,397,367" alt="tube_0 center tube_1" href="#link8">
<area shape="rect" coords="5,376,397,536" alt="DAS's plot" href="#link9">
<area shape="rect" coords="401,48,441,63" alt="Main tab" href="#link10">
<area shape="rect" coords="401,62,788,360" alt="Main tab" href="#link10">
<area shape="rect" coords="440,48,482,61" alt="log book tab" href="#link11">
<area shape="rect" coords="401,366,794,535" alt="Mapped plot" href="#link13">
</area>

<ul>
<li><h3><font color=red><a id="link0">Description of GUI</a></font></h3></li>

 <ul>
 <li><b>Top Menu</b></li>

  <ul>
  <li><a id="link1">File</a></li>
    <center><img src="images/File_menu.png"></center>
    <ul>
    <li><b>Open Run #...</b>: to open an archived NeXus file.</li>
    <li><b>Open local Run #...</b>: to open a local NeXus file. In this case, the program looks 
        for the run number of interest in the folder <font color=blue>~/local/</font>.</li>
    <li><b>Open Mapped Histogram...</b>:(not available for most users) to open a mapped histogram
        file (<font color=blue>BSS_<i>run_number</i>_neutron_histo_mapped.dat</font>).</li>
    <li><b>Exit</b>: to quit the program.
    </ul><br>

  <li><a id="link2">RealignGUI</a></li>
    <center><img src="images/realignGUI_menu.png"></center>
    <ul>
    <li><b>about RealignGUI</b>: to get the name of the developer.</li>
    <li><b>Color Tool for DAS</b>: to change the color/contrast of the <i>DAS's plot</i>. 
        Can be used for example to increase contrast between signal and background.</li>
    <li><b>Color Tool for realign data</b>: To change the color/contrast of the <i>Mapped 
        plot</i>.</li>
    </ul><br>

  <li><a id="link3">sns_idl_tools</a></li>

  </ul>
  <br>
 <li><a id="link4"><b>Main displays</b></a></li>

  <ul>
  <li><a id="link5">Tube per tube plot</a></li>
    <center><img src="images/Drawing_tabs.png"><img src="images/tubes.png"><br></center>
    <br>This plot displays the number of counts versus the number of pixels along a tube (as 
    defined by the DAS) integrated over all the time bins. The position of the selected tube
    is highlighted in the <b>DAS's plot</b> using a red line (see figure below).<br>
    <u>Definition of a tube as seen by the DAS</u>: 
    a tube as defined by the DAS is shown on the following picture.<br>
    The bottom slider allows the user to move from tube to tube (1 to 63). 
    The first 32 tubes are from the top bank and the following 32 are from the bottom bank.<br>
    <u>NB</u>: the diffraction tube are never consider in this program and then never plotted. <br>
    The bottom right button named <b>TOF++</b> is used to add the selected tube into the
    list of tube in the third tab, <font color=green>Counts vs TOF</font>.<br>
    <center><img src="images/tab_1.png"></center><br><br>

  <li><a id="link6">Tube per tube for each Nt</a></li>
    <center><img src="images/tube_per_tube_tab.png"></center>
    <br>This plot displays the number of counts versus the number of pixels along a tube (as
    defined by the DAS - see previous bullet) but for a given time bin. The two bottom sliders
    allow to change the time bin (Nt) and the tube number (0-63). The position of the selected
    tube is shown on the <b>DAS's plot</b> with a light purple line (see picture below).
    The bottom right box displays the time bin range selected in microS.
    <br> The previous figure shows two plots, red and white. The red one is from the raw data and the
    white one is from the realigned data. The white plot is plotted once the <b>Realign/plot</b> 
    process is completed. 
    <center><img src="images/tab_2.png"></center><br>
    
  <li><a id="link7">Counts vs TOF</a></li>
    <center><img src="images/counts_vs_tof_tab.png"></center><br>
    <br>This plots displays the counts vs TOF of a given range of tubes and/or pixels. The x-axis
    is determined by the binning of the histo_mapped file. To change this axis, one must use
    the rebin_NeXus tool and rebin the NeXus file using a different rebinning parameter, algorithm,
    minimum and maximum time bin. Don't forget that the NeXus created is local (<font color=green>
    ~/local/</font>).<br><br>
    <b>Tube(s)</b>: to select a list or range of tubes, follow one of the following technique:<br>
      <ul>
      <li><i>5,10,15</i> to select tubes 5, 10 and 15</li>
      <li><i>5-10</i> to select tubes 5,6,7,8,9 and 10</li>
      <li>5,8,10-12</i> to select tubes 5,8,10,11 and 12</li>
      <li><b>TOF++</b> use the button found in the bottom right part of the tab called <b>
      Tube per tube plot</b></li>
      </ul>
    <b>Pixel(s)</b>: to select a list or range of pixels, follow one of the following technique:<br>
      <ul>
      <li><i>(40,10)</i> to select pixel number 10 of tube # 40</li>
      <li><i>(40,10)-(42,5)</i> to select all the pixels between the 10th pixel of tube number 40 and
      pixel number 5 of tube number 42.</li>
      <li><b>TOF++</b> use the button found in Pixel ID box of the the tab called 
      <b>Main Tab</b>.</li>
      </ul>
    <br>Once the button <b>VALIDATE</b> has been pressed, the tubes and pixels selected are
    dislayed on the <b>DAS's plot</b> window, as shown on the picture below.<br><br>
    <center><img src="images/tube_pixel_displayed.png"></center><br>
  </ul>
  <br>
 <li><a id="link8"><b>Edges interactive window</b></a></li>
  <center><img src="images/Tube0_1_index.png"></center>
  <br> This box interacts with the plot from the first tab called <b>Tube per tube plot</b>
  and moves the position of the calculated edges and center positions of the tubes (purple
  diamond shown in the following picture).<br>
  <center><img src="images/purple_diamond.png"></center><br>
  <ul>
  <li><b>Tube0</b>: interacts with the left part of the plot (the first two diamonds).</li>
    <ul>
    <li><b>Left</b>: to move the first diamond, either press <b>-</b> to move the diamond to the
        left and <b>+</b> to move it to the right. It is also possible to edit the text box and
	gives the position desired (pixel number relative to the start of the tube).</li>
    <li><b>Right</b>: acts the same but for the second diamond.
    </ul>
  <li><b>Center</b>: interacts with the third diamond, between the two physical tubes.</li>
  <li><b>Tube1</b>: interacts with the right part of the plot (the last two diamonds).</li>
    <ul>
    <li><b>Left</b>: to move the fourth diamond, either press <b>-</b> to move the diamond to the
        left and <b>+</b> to move it to the right. It is also possible to edit the text box and
	gives the position desired (pixel number relative to the start of the tube).</li>
    <li><b>Right</b>: acts the same but for the last diamond.
    </ul>
  </ul>
  
 <li><a id="link9"><b>DAS's plot</b></a></li>
  <center><img src="images/DAS_plot.png"></center><br>
  This is where the data are plotted using the DAS's representation. The left part of the plot
  is the top bank and the right part is the bottom bank. 1 tube in DAS's world (2 physical tubes
  as shown on picture of section <b>tube per tube plot</b>), runs from bottom to top of plot. The
  dark horizontal area is the center of the DAS's tubes. From the instrument point of view, the 
  pixels closed to this dark area are the one closer to the sample. <br>

<li><a id="link10"><b>Main interactive tab</b></a></li>
<h3>Click on picture to get more information about a particular element</h3> 
  <center><img src="images/Main_tab.png" usemap="main_tab"></center><br>
  
  <map id="main_tab" name="main_tab">
  <area shape="rect" coords="11,33,358,152" alt="infos" href="#infos">
  <area shape="rect" coords="13,164,57,180" alt="pixelID_tab" href="#pixelID_tab">
  <area shape="rect" coords="13,180,245,327" alt="pixelID_tab" href="#pixelID_tab">
  <area shape="rect" coords="57,164,92,180" alt="tube_tab" href="#tube_tab">
  <area shape="rect" coords="92,164,181,180" alt="row_of_pixels" href="#row_of_pixels">
  <area shape="rect" coords="14,340,246,399" alt="reinitialize" href="#reinitialize">
  <area shape="rect" coords="12,409,251,433" alt="realign_plot_buttons" 
  href="#realign_plot_buttons">
  <area shape="rect" coords="255,164,358,231" alt="pixelID_infos" href="#pixelID_infos">
  <area shape="rect" coords="258,239,360,433" alt="data_removed" href="#data_removed">
  <area shape="rect" coords="365,32,544,431" alt="pixel_value" href="#pixel_value">
  </map>

  This tab is divided into several boxed and buttons.
  <ul>
  <li><b><a id="infos">Infos</a></b>:</li> 
      gives some information about the various processes involved like name of 
      NeXus file opened. To get more information, check the <b>Log book</b> tab.<br>
      <center><img src="images/infos.png"></center><br>
  <li><b><a id="pixelID_infos">Pixel ID info</a></b>:</li> 
      displays the PixelID (as defined in the NeXus file), tube number
      and bank number of the pixelid and tube selected.<br>
      <center><img src="images/pixel_tube_infos.pngs"></center><br>
  <li><b>Pixel - Tube - Row of pixels</b></li><br>
      <ul>
      <li><b><a id="pixelID_tab">Pixel ID</a></b>:</li> 
          slider uses to get information about a given pixel. The <b>Pixel ID 
          info</b> box displays these information. The pixelID selected is shown in the main 
	  display of the tab <b>Tube per tube plot</b> as a blue diamond.<br>
          The number of counts of this pixelid can be reset to 0 by pressing the button called <b>
          REMOVE</b>. This pixel ID is then automatically added to the list of Data Removed 
	  (box placed below the Pixel ID info box). <br>
          To reset a change on a particular pixelID, just use the slider to move to the pixel ID of 
          interest and press <b>ADD</b>. 
          <center><img src="images/pixelID_removed.png"></center><br>
      <li><b><a id="tube_tab">Tube</a></b>:</li> 
          to remove the selected tube in the <b>Tube per tube plot</b> tab 
          and also represented by the red line in the <b>DAS's plot</b> window, pressed the
          <b>REMOVE</b> button. Once the tube has been removed, this tube is added to the list of
          <b>Data removed</b>. To bring back a tube previously removed, just use the button 
	  <b>ADD</b>.<br><center><img src="images/tube_removed.png"></center><br><br>
      <li><b><a id="row_of_pixels">Row of pixels</a></b>:</li> 
           <br><center><img src="images/row_remove.png"></center>
      </ul>
  <li><b><a id="reinitialize">REINITIALIZE ALL VARIABLES</a></b>:</li> 
      To bring back to life all the tubes and pixel removed. The program is defined to removed
      by default the tubes 28, 29, 30, 31, 60, 61, 62 and 63. Right now these tubes are 
      disconnected and then do not contain any data. <br>
      In order to avoid any mistakes, a confirmation window opens. If you really want to 
      reinitialize all the variables, press <b>YES</b>. If not, press <b>CANCEL</b>.
      <br><center><img src="images/reinitialize_variables.png"></center><br>
  <li><b><a id="data_removed">Data removed</a></b>:</li> 
      List the tubes and pixels removed. <br>
      <center><img src="images/data_removed.png"></center><br>
  <li><b><a id="realign_plot_button">Realign/Plot</a></b>:</li>
      Starts the realignment process that creates a histogram file of the data realigned. The data
      are rebin such that the edges defined by the algorithm or manually set on the main display
      (purple diamonds) becomes the new edges of the tubes. The new edges of the tubes are defined 
      by:
      <ul>
      <li> <font color=red>Tube0-left</font> mark becomes <font color=red>pixelID#2</font></li>
      <li> <font color=red>Tube0-right</font> mark becomes <font color=red>pixelID#61</font></li>
      <li> <font color=red>Center</font> mark becomes <font color=red>pixelID#63</font></li>
      <li> <font color=red>Tube1-left</font> mark becomes <font color=red>pixelID#65</font></li>
      <li> <font color=red>Tube1-right</font> mark becomes <font color=red>pixelID#121</font></li>
      </ul><br>
      <b>Realign/Plot</b> create the following graph of the realigned data.<br>
      <center><img src="images/mapped_plot.png"></center><br>
  <li><b>CREATE histo/NeXus</b>:</li>
      Create the local NeXus file. For example, if the input NeXus file is BSS_60.nxs, the local
      NeXus file will be located in the following folder:<br>
      <font color=green>~/local/RealignBSS/BSS/...</font><br>
      <center><img src="images/path_to_nexus.png"></center><br>
      
  <li><b>Pixels values</b>:</li>
      <center><img src="images/pixel_values.png"></center><br>
  </ul><br>

 <li><a id="link11"><b>Log book tab</b></a></li>
  <center><img src="images/Log_book.png"></center>
  <br>

 <li><a id="link13"><b>Mapped plot</b></a></li>
  <center><img src="images/mapped_plot.png"></center>
  <br>

 </ul>

<li><h3><font color=red><a id="link20">Tutorial</a></font></h3></li>
  <ul>
  <li><a id="link21">Open NeXus</a></li>
      Before doing anything, you must open a NeXus file. To do so you just need to enter
      the run number of that file. If you want the untouched original NeXus file, just select 
      <b>Open NeXus...</b> in the top menu called <i>File</i>. If you have created a local 
      NeXus file in your home directory (~/local), you need 
  <li><a id="link22">Realign data</a></li>
 
    <ul>
    <li><a =id="link23">Check data</a></li>
  
    <ul>
    <li><a id="link24">Check counts of a tube</a></li>
    <li><a id="link25">Check counts of a pixelID</a></li>
    </ul>
   
  <li><a id="link26">Interact with data</a></li>

    <ul>
    <li><a id="link27">Moved precalculated tube edges</a></li>
    <li><a id="link28">Removed/add pixel</a></li>
    <li><a id="link29">Removed/add tube</a> </li>
    <li><a id="link30">Reinitialize all variables</a></li>
    </ul>
    
    <li><a id="link31">Check tube per tube data for a given time bin</a></li>

    <li><a id="link32">check counts versus time of flight</a></li>
    </ul>
  
  <li><a id="link33">Create realigned data file</a></li>

  <li><a id="link34">Create local NeXus file</a></li>

  <li><a id="link35">Check result using Counts vs TOF</a></li>
  </ul>
</ul>






















</html>
